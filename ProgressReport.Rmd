---
title: "Note Equilibria"
author: "Thomas de Graaff"
date: "June 10, 2015"
output: pdf_document
---

## Introduction

This progress report gives output for the property crime of youth

## Preamble 

First, we need to read in packages, my own functions and the two datasets

```{r results='hide', message=FALSE, warning=FALSE}
setwd("C:/Users/tgf200/Dropbox/Thomas/papers/Crime")
library(tidyr)
library(foreign)
library(ggplot2)
library(rootSolve)
library(AER)
library(dplyr)
library(reshape2)
source("./prog/R/iterationBayer.R")
source("./prog/R/CharacteristicsEq.R")
source("./prog/R/MakeFig.R")
source("./prog/R/FindEquilibria.R")

data <- read.table("./Data/GeneralData.csv", header=TRUE, sep=",")
data <- data %>%  # fill in crime type
          filter(! is.na(alpha_crime)) %>%
          mutate(pfield = pfieldcrime, 
                 interaction = pfield * addrdens,
                 alpha = alpha_crime,
                 se = sealpha_crime
                 )
dataind <- read.dta("./Data/hat_anyproperty2006_jongeren.dta")
```

## We then specify the specifications: 

```{r results='hide', message=FALSE, warning=FALSE}
forminit  <- alpha~addrdens + oneperdens + oneparentdens + perperhh + opleiding + socklasse + k_tweeverd + 
  v_uit_perc + v_in_perc + schooldens + perchouseown + shops + polavail_mean_2005+pfield+interaction
formcrime <- alpha~addrdens + oneperdens + oneparentdens + perperhh + opleiding + socklasse + k_tweeverd + 
  v_uit_perc + v_in_perc + schooldens + perchouseown + shops + polavail_mean_2005+pfield+interaction |
  addrdens + oneperdens +oneparentdens + perperhh + opleiding + socklasse + k_tweeverd + v_uit_perc + v_in_perc + 
  schooldens + perchouseown + shops + polavail_mean_2005+instrument+instrinter
dataind$directions.foreign <- factor(dataind$foreign)
dataind$foreign <- as.numeric(dataind$directions.foreign) - 1
```

## And then the estimation procedure:

```{r}
output <- iteration2sls(dataind, data, formcrime, forminit, youth=TRUE)
summary(output$iv)
```

## With final analysis of the output

We first want to find all equilibria for all iterations

```{r}
matrices <- findequilibria(output)
```

Then we want to find the percentages of 3 equilibra occuring per iteration

```{r}
counteq(matrices$cmat)
```

Then we want to know the number of low equiblibra (smaller than 50%). This also indicates the number of equilibria changing from low to high (larger than 50%)

```{r}
counteqlow(output$instrument)
```

And finally, we want to know whether our found equilibria are close (in this case the difference should be smaller than 2% in an absolute sence) to the real crime rates

```{r}
percclose(output$alpha_est/100, output$instrument, 0.02)
```






